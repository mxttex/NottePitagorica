<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>

    <canvas id="gameCanvas"></canvas>

    <script>
        let canvas, engine, camera, scene, sunPivot, earthPivot, moonPivot, sun, earth, moon;

        window.addEventListener('DOMContentLoaded', () => {
            canvas = document.getElementById("gameCanvas");
            engine = new BABYLON.Engine(canvas, true);
            scene = new BABYLON.Scene(engine);

            // Creare la camera
            camera = new BABYLON.ArcRotateCamera("Camera", Math.PI / 2, Math.PI / 4, 20, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(canvas, true);
            camera.wheelPrecision = 50;
            camera.lowerRadiusLimit = 1;
            camera.upperRadiusLimit = 100;

            // Creare le luci
            new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(1, 1, 0), scene).intensity = 0.5;
            let light2 = new BABYLON.PointLight("light2", new BABYLON.Vector3(0, 0, -4), scene);
            light2.intensity = 0.5;
            light2.parent = camera;
        

            // Creare i nodi di trasformazione
            cameraPivot = new BABYLON.TransformNode('camPivot', scene)
            sunPivot = new BABYLON.TransformNode('sunPivot', scene);
            earthPivot = new BABYLON.TransformNode('earthPivot', scene);
            earthPivot.parent = sunPivot;
            moonPivot = new BABYLON.TransformNode('moonPivot', scene);
            moonPivot.parent = earthPivot;
            camera.parent = cameraPivot;

            // Creare un grande piano dietro la scena e applicare una texture
            
            scene.clearColor = new BABYLON.Color3(0, 0, 0)
            // Caricare i modelli
            let radius1 = 7;
            let radius2 = 2;

            BABYLON.SceneLoader.ImportMesh("", "files/", "sun.glb", scene, function (meshes) {
                sun = meshes[0];
                sun.parent = sunPivot;
                sun.scaling = new BABYLON.Vector3(2, 2, 2);
            });

            BABYLON.SceneLoader.ImportMesh("", "files/", "earth.glb", scene, function (meshes) {
                earth = meshes[0];
                earth.parent = earthPivot;
                earthPivot.position.x = radius1;
                earth.scaling = new BABYLON.Vector3(1, 1, 1);
            });

            BABYLON.SceneLoader.ImportMesh("", "files/", "moon.glb", scene, function (meshes) {
                moon = meshes[0];
                moon.parent = moonPivot;
                moonPivot.position.x = radius2;
                moon.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
            });

            // Animare i modelli
            let angle = 0;
            scene.registerBeforeRender(() => {
                angle += 0.01;
                earthPivot.position.x = radius1 * Math.cos(angle);
                earthPivot.position.z = radius1 * Math.sin(angle);

                moonPivot.position.x = radius2 * Math.cos(5 * angle);
                moonPivot.position.z = radius2 * Math.sin(5 * angle);

                if (earth) earth.rotation.y += 0.01;
                if (sun) sunPivot.rotation.y += 0.002;
            });

            engine.runRenderLoop(() => scene.render());
            window.addEventListener("resize", () => engine.resize());
        });
    </script>

    <style>
        #gameCanvas {
            width: 100%;
            height: 100vh;
        }
    </style>
</body>

</html>
